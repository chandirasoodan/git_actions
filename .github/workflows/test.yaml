 name: Ansible_deployment

 on: workflow_dispatch
 env:
   ACCESS_KEY: ${{ vars.ACCESS_KEY }}
   SECRET_KEY: ${{ vars.SECRET_KEY }}

 jobs:
   build:
     runs-on: self-hosted

     steps:
       - uses: actions/checkout@v4
       - name: Set up Python
         uses: actions/setup-python@v2
         with:
           python-version: '3.x'
       - name: Install dependencies
         run: |
           sudo apt update
           sudo apt upgrade -y
           sudo apt install -y software-properties-common
           sudo add-apt-repository --yes --update ppa:ansible/ansible
           sudo apt install -y ansible python3-pip
           sudo apt install pipx -y
           pipx install awscli
           export PATH=$PATH:/home/ubuntu/.local/bin


       - name: Set environment variables
         run: |
           export ACCESS_KEY=$ACCESS_KEY
           export SECRET_KEY=$SECRET_KEY
           export AWS_ACCESS_KEY_ID=$ACCESS_KEY
           export AWS_SECRET_ACCESS_KEY=$SECRET_KEY
       - name: Verify Ansible installation
         run: ansible --version
       - name: Run Ansible playbook
         run: ansible-playbook ./ansible.yaml -vvv
